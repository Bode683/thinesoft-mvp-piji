{
  "info": {
    "name": "02 - User Management (CRUD)",
    "description": "Complete CRUD operations for Keycloak user management",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{access_token}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "List All Users",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('Users array exists', function () {",
              "        pm.expect(jsonData).to.be.an('array');",
              "    });",
              "    if (jsonData.length > 0) {",
              "        pm.environment.set('test_user_id', jsonData[0].id);",
              "    }",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users?max=100",
          "host": ["{{admin_api_base}}"],
          "path": ["users"],
          "query": [
            {
              "key": "max",
              "value": "100",
              "description": "Maximum number of users to return"
            },
            {
              "key": "first",
              "value": "0",
              "description": "Pagination offset",
              "disabled": true
            },
            {
              "key": "search",
              "value": "",
              "description": "Search string",
              "disabled": true
            }
          ]
        },
        "description": "Get a list of all users in the realm with pagination support."
      },
      "response": []
    },
    {
      "name": "Get User by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('User ID exists', function () {",
              "        pm.expect(jsonData.id).to.exist;",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}"]
        },
        "description": "Get detailed information about a specific user by their ID."
      },
      "response": []
    },
    {
      "name": "Search Users by Username",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('Users array exists', function () {",
              "        pm.expect(jsonData).to.be.an('array');",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users?username=john.doe&exact=true",
          "host": ["{{admin_api_base}}"],
          "path": ["users"],
          "query": [
            {
              "key": "username",
              "value": "john.doe"
            },
            {
              "key": "exact",
              "value": "true",
              "description": "Exact match"
            }
          ]
        },
        "description": "Search for users by username with exact or partial matching."
      },
      "response": []
    },
    {
      "name": "Search Users by Email",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users?email=john.doe@theddt.local",
          "host": ["{{admin_api_base}}"],
          "path": ["users"],
          "query": [
            {
              "key": "email",
              "value": "john.doe@theddt.local"
            }
          ]
        },
        "description": "Search for users by email address."
      },
      "response": []
    },
    {
      "name": "Create User",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    pm.test('Status code is 201', function () {",
              "        pm.response.to.have.status(201);",
              "    });",
              "    var location = pm.response.headers.get('Location');",
              "    if (location) {",
              "        var userId = location.split('/').pop();",
              "        pm.environment.set('test_user_id', userId);",
              "        console.log('Created user ID: ' + userId);",
              "    }",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"test.user\",\n  \"email\": \"test.user@theddt.local\",\n  \"firstName\": \"Test\",\n  \"lastName\": \"User\",\n  \"enabled\": true,\n  \"emailVerified\": true,\n  \"attributes\": {\n    \"department\": [\"Engineering\"],\n    \"employeeId\": [\"EMP999\"]\n  },\n  \"credentials\": [\n    {\n      \"type\": \"password\",\n      \"value\": \"Test@123\",\n      \"temporary\": false\n    }\n  ]\n}"
        },
        "url": {
          "raw": "{{admin_api_base}}/users",
          "host": ["{{admin_api_base}}"],
          "path": ["users"]
        },
        "description": "Create a new user in the realm with credentials and attributes."
      },
      "response": []
    },
    {
      "name": "Update User",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 204', function () {",
              "    pm.response.to.have.status(204);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"firstName\": \"Test Updated\",\n  \"lastName\": \"User Updated\",\n  \"email\": \"test.user.updated@theddt.local\",\n  \"attributes\": {\n    \"department\": [\"IT\"],\n    \"employeeId\": [\"EMP999\"],\n    \"phoneNumber\": [\"+1-555-9999\"]\n  }\n}"
        },
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}"]
        },
        "description": "Update an existing user's information."
      },
      "response": []
    },
    {
      "name": "Delete User",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 204', function () {",
              "    pm.response.to.have.status(204);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}"]
        },
        "description": "Delete a user from the realm."
      },
      "response": []
    },
    {
      "name": "Reset User Password",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 204', function () {",
              "    pm.response.to.have.status(204);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"type\": \"password\",\n  \"value\": \"NewPassword@123\",\n  \"temporary\": false\n}"
        },
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/reset-password",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "reset-password"]
        },
        "description": "Reset a user's password. Set temporary to true to force password change on next login."
      },
      "response": []
    },
    {
      "name": "Get User Sessions",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('Sessions array exists', function () {",
              "        pm.expect(jsonData).to.be.an('array');",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/sessions",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "sessions"]
        },
        "description": "Get all active sessions for a specific user."
      },
      "response": []
    },
    {
      "name": "Logout User Sessions",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 204', function () {",
              "    pm.response.to.have.status(204);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/logout",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "logout"]
        },
        "description": "Logout all sessions for a specific user."
      },
      "response": []
    },
    {
      "name": "Send Verification Email",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 204 or 200', function () {",
              "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/send-verify-email",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "send-verify-email"]
        },
        "description": "Send email verification to user."
      },
      "response": []
    },
    {
      "name": "Execute Actions Email",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 204 or 200', function () {",
              "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "[\"UPDATE_PASSWORD\", \"VERIFY_EMAIL\"]"
        },
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/execute-actions-email",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "execute-actions-email"]
        },
        "description": "Send email to user with required actions (UPDATE_PASSWORD, VERIFY_EMAIL, etc.)."
      },
      "response": []
    },
    {
      "name": "Get User Groups",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('Groups array exists', function () {",
              "        pm.expect(jsonData).to.be.an('array');",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/groups",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "groups"]
        },
        "description": "Get all groups that a user belongs to."
      },
      "response": []
    },
    {
      "name": "Get User Role Mappings",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/role-mappings",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "role-mappings"]
        },
        "description": "Get all role mappings (realm and client roles) for a user."
      },
      "response": []
    },
    {
      "name": "Get User Realm Roles",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('Roles array exists', function () {",
              "        pm.expect(jsonData).to.be.an('array');",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/role-mappings/realm",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "role-mappings", "realm"]
        },
        "description": "Get realm-level roles assigned to a user."
      },
      "response": []
    },
    {
      "name": "Count Users",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var count = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('Count is a number', function () {",
              "        pm.expect(count).to.be.a('number');",
              "    });",
              "    console.log('Total users: ' + count);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/count",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "count"]
        },
        "description": "Get the total count of users in the realm."
      },
      "response": []
    },
    {
      "name": "Get User Consents",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "    pm.test('Consents array exists', function () {",
              "        pm.expect(jsonData).to.be.an('array');",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/consents",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "consents"]
        },
        "description": "Get all consents granted by the user."
      },
      "response": []
    },
    {
      "name": "Impersonate User",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.test('Status code is 200', function () {",
              "        pm.response.to.have.status(200);",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{admin_api_base}}/users/{{test_user_id}}/impersonation",
          "host": ["{{admin_api_base}}"],
          "path": ["users", "{{test_user_id}}", "impersonation"]
        },
        "description": "Impersonate a user (admin feature)."
      },
      "response": []
    }
  ]
}
